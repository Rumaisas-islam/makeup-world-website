<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products Inventory</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body {
            background-color: #fff6f8;
            font-family: 'Poppins', sans-serif;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .inventory-box {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.2);
        }

        .title {
            color: #ff4da6;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
        }

        .btn-pink {
            background-color: #ff4da6;
            color: white;
            border: none;
        }

        .btn-pink:hover {
            background-color: #ff66b2;
        }

        .form-control, .form-select {
            border-radius: 10px;
        }

        table {
            border-radius: 12px;
            overflow: hidden;
        }

        .no-products {
            text-align: center;
            color: #999;
            font-style: italic;
            margin-top: 20px;
        }
    </style>
</head>

<body>
<div class="container my-5">
    <div class="inventory-box">
        <h2 class="title">ðŸ’„ Product Inventory</h2>

        <!-- Search Bar -->
        <form method="get" action="{{ url_for('show_products') }}" class="row g-3 mb-4">
            <div class="col-md-4">
                <input type="text" name="q" class="form-control" placeholder="Search by Product Name..." value="{{ request.args.get('q', '') }}">
            </div>
            <div class="col-md-3">
                <select name="company" class="form-select">
                    <option>All Companies</option>
                    {% for company in companies %}
                    <option value="{{ company }}" {% if request.args.get('company') == company %}selected{% endif %}>{{ company }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <select name="category" class="form-select">
                    <option>All Categories</option>
                    <option value="Makeup">Makeup</option>
                    <option value="Skincare">Skincare</option>
                    <option value="Haircare">Haircare</option>
                    <option value="Fragrance">Fragrance</option>
                </select>
            </div>
            <div class="col-md-2 d-flex">
                <button type="submit" class="btn btn-pink me-2">Search</button>
                <a href="{{ url_for('add_product') }}" class="btn btn-pink">+ Add Product</a>
            </div>
        </form>

        <!-- Product Table -->
        {% if products %}
        <div class="table-responsive">
            <table class="table table-bordered align-middle">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Price (PKR)</th>
                        <th>Company</th>
                        <th>Category</th>
                        <th>Use</th>
                        <th>Stock</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td>{{ product.id }}</td>
                        <td>{{ product.name }}</td>
                        <td>{{ product.price }}</td>
                        <td>{{ product.company }}</td>
                        <td>{{ product.category }}</td>
                        <td>{{ product.use }}</td>
                        <td>
                            {% if product.stock == 0 %}
                                <span class="badge bg-danger">Out of Stock</span>
                            {% elif product.stock <= 5 %}
                                <span class="badge bg-warning text-dark">Low Stock</span>
                            {% else %}
                                <span class="badge bg-success">In Stock</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('edit_product', id=product.id) }}" class="btn btn-sm btn-outline-primary">Edit</a>
                            <a href="{{ url_for('delete_product', id=product.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirmDelete(event)">Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="no-products">No products found. Try adding one!</p>
        {% endif %}
    </div>
</div>

<!-- Bootstrap Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- SweetAlert2 Script -->
<script>
function confirmDelete(event) {
    event.preventDefault();
    const url = event.target.href;
    Swal.fire({
        title: 'Are you sure?',
        text: "This product will be permanently deleted!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ff4da6',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = url;
        }
    });
}
</script>

</body>
</html>
